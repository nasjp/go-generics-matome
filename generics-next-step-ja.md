# ジェネリクスの次のステップ

イアン・ランス・テイラー、ロバート・グリセマー

2020年6月16日

## はじめに

前回、「Goにジェネリクスを追加する可能性について」を書いてから約1年が経ちました。
そろそろ更新の時期です。

## デザインの更新

私たちは、[ジェネリクスのデザインドラフト](https://go.googlesource.com/proposal/+/refs/heads/master/design/go2draft-contracts.md)を改良し続けてきました。
これは、デザインドラフトで説明されているようにジェネリクスを使用するGoコードを解析し、型エラーを報告するプログラムです。
コードの例も書きました。 また、多くの人からのフィードバックを集めました。ありがとう！

私たちが学んだことをもとに、[最新のデザインドラフト](https://go.googlesource.com/proposal/+/refs/heads/master/design/go2draft-type-parameters.md)を公開します。
最大の変更点は、コントラクトという概念を取り払ったことです。
契約とインターフェースタイプの違いは混乱を招くものでしたので、その違いを取り除いています。
型パラメータはインタフェース型によって制約されるようになりました。
インターフェース型は、制約として使用される場合に限り、型リストを含めることができるようになりました。
より複雑なケースでは、パラメータ化されたインタフェース型を使用します。

このデザインドラフトをよりシンプルでわかりやすいものにしたいと考えています。

## 実験ツール

デザインドラフトをさらに洗練させる方法を決めるために、変換ツールをリリースします。
これは、デザインドラフトに記載されているバージョンのジェネリクスを使用して書かれたコードをタイプチェックし、実行するためのツールです。
このツールは、ジェネリクスコードを通常のGoコードに変換することで動作します。
この変換プロセスにはいくつかの制限がありますが、一般的なGoコードがどのようなものかを理解するのに十分なものになることを期待しています。
もしも言語内で受け入れられた場合、ジェネリクスの実装は、異なる動作をすることになります。
(私たちは、直接コンパイラでの実装がどのようになるかをスケッチし始めたばかりです。)

このツールは、The Go Playgroundの改良版である<https://go2goplay.golang.org>で利用できます。
このThe Go Playgroundは普通のThe Go Playgroundと同じように動作しますが、ジェネリクスをサポートしています。

このツールは自分でビルドして使うこともできます。Goリポジトリのmasterブランチで利用可能です。
[ソースからGoをインストールする手順](https://golang.org/doc/install/source)に従ってください。
最新のリリースタグをチェックアウトするように指示されている場合は、代わりに`git checkout dev.go2go`を実行します。
そして、指示されたとおりにGoツールチェーンをビルドします。

変換ツールは[README.go2go](https://go.googlesource.com/go/+/refs/heads/dev.go2go/README.go2go.md)に文書化されています。

## 次のステップ

私たちは、このツールがGoコミュニティにジェネリクスを試す機会を与えることを願っています。学びたいことは主に2つあります。

まず第ーに、ジェネリクスコードは意味があるでしょうか？
Goっぽいでしょうか？
人々どんなことに驚くのでしょうか？
エラーメッセージはべんりでしょうか？

第二に、多くの人がGoにはジェネリクスが必要だと言っていますが、それが何を意味するのかは必ずしも正確にはわかりません。
このドラフトデザインは、この問題に有用な方法で対処しているのでしょうか?
「Goにジェネリクスがあれば解決できるのに」と思わせるような問題があった場合、このツールを使ったときにその問題を解決できますか？

私たちは、Goコミュニティから収集したフィードバックを使用して、今後の進め方を決定します。
ドラフトデザインが好評で、大幅な変更が必要ない場合は、次のステップとして、正式な言語変更の提案を行います。
期待値を設定するために、ドラフトデザインに全員が完全に満足し、これ以上の調整を必要としない場合、
ジェネリクスをGoに追加できるようになるのは、2021年8月に予定されているGo 1.17のリリースが最も早いでしょう。
もちろん、実際には予期せぬ問題が発生する可能性もありますので、これは楽観的なタイムラインです。

## フィードバック

言語の変更に関するフィードバックを提供する最良の方法は、メーリングリスト<golang-nuts@googlegroups.com>にあります。
メーリングリストは不完全なものですが、最初の議論のための最良の選択肢のように思えます。
デザインドラフトについて書くときは、件名の最初に`[generics]`をつけてください。

ジェネリクスタイプチェッカーや翻訳ツールでバグを見つけた場合は、<https://golang.org/issue>にある標準のGo issue trackerに報告してください。
問題のタイトルは`cmd/go2go:`で始めてください。
Go issue trackerは言語の変更について議論するのには最適な場所ではないことに注意してください。

皆様のご意見をお待ちしております。

## 謝辞

まだ終わったわけではないが、長い道のりを歩んできました。
多くの助けがなければここにはいないでしょう。

Goにおけるジェネリクスについて正式に考え、設計の理論的な側面を明らかにしてくれたフィリップ・ワドラー氏とその共同研究者に感謝したいと思います。
彼らの論文「[Featherweight Go](https://arxiv.org/abs/2005.11710)」は、制限されたバージョンのGoにてジェネリクスを分析しており、[GitHub](https://github.com/rhu1/fg)上でプロトタイプを開発しています。

また、以前のドラフトデザインに詳細なご意見をいただいた[方々](https://go.googlesource.com/proposal/+/refs/heads/master/design/go2draft-type-parameters.md#acknowledgements)にも感謝いたします。

最後になりましたが、最後になりましたが、Goチームの多くの方々、Go issue trackerへの多くの貢献者、そして初期のドラフトデザインに対するアイデアやフィードバックを共有してくださった皆様に感謝します。
私たちはそのすべてを読み、感謝しています。
あなたなしではここにはいられませんでした。

# 関連記事

- [Proposals for Go 1.15](https://blog.golang.org/go1.15-proposals)
- [Experiment, Simplify, Ship](https://blog.golang.org/experiment)
- [Why Generics?](https://blog.golang.org/why-generics)
- [Next steps toward Go 2](https://blog.golang.org/go2-next-steps)
- [Go 2, here we come!](https://blog.golang.org/go2-here-we-come)
